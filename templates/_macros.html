{% macro weather_icon(desc, local_hour, sunrise_hour, sunset_hour) -%}
  {# Normalize description and hours #}
  {% set d = (desc or '')|lower %}
  {% set lh = local_hour or 0 %}
  {% set sr = sunrise_hour or 6 %}
  {% set ss = sunset_hour or 18 %}

  {# Night for THAT city = before sunrise OR at/after sunset #}
  {% set is_night = lh < sr or lh >= ss %}

  {# At night: ALWAYS moon icon #}
  {% if is_night %}
    <i class="fa-regular fa-moon" aria-label="Night"></i>
  {% else %}
    {# Daytime weather-specific icons #}
    {% if 'clear' in d %}
      <i class="fa-solid fa-sun" aria-label="Clear"></i>
    {% elif 'light drizzle' in d %}
      <i class="fa-solid fa-cloud" aria-label="Drizzle"></i>
    {% elif 'moderate drizzle' in d or 'dense drizzle' in d %}
      <i class="fa-solid fa-cloud-showers-heavy" aria-label="Drizzle"></i>
    {% elif 'freezing drizzle' in d or 'freezing rain' in d %}
      <i class="fa-solid fa-snowflake" aria-label="Freezing"></i>
    {% elif 'rain' in d %}
      <i class="fa-solid fa-cloud-showers-heavy" aria-label="Rain"></i>
    {% elif 'snow' in d or 'freezing' in d %}
      <i class="fa-solid fa-snowflake" aria-label="Snow"></i>
    {% elif 'cloud' in d %}
      <i class="fa-solid fa-cloud" aria-label="Cloudy"></i>
    {% elif 'thunder' in d %}
      <i class="fa-solid fa-bolt" aria-label="Thunder"></i>
    {% elif 'mist' in d or 'fog' in d or 'smog' in d or 'haze' in d %}
      <i class="fa-solid fa-smog" aria-label="Fog"></i>
    {% else %}
      <i class="fa-solid fa-question" aria-label="Unknown"></i>
    {% endif %}
  {% endif %}
{%- endmacro %}

